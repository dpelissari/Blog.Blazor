@page "/int/autor/editar/{id?}"
@page "/int/autor/novo/"

﻿@using Blog.Blazor.Interfaces
@using Blog.Blazor.Models

@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject IAutorService AutorService


<div class="container p-4">

    @if (modoEdicao)
    {
        <h1>Editand o autor "@autor.Nome"</h1>

        <EditForm Model="@autor" OnValidSubmit="@AtualizarAutor" FormName="AtualizaAutor" Enhance>
            <DataAnnotationsValidator />

            <div>
                <label>Imagem</label>
                <ImagemUpload Modelo="autor" DiretorioImagem="autores" LarguraImagem="120"></ImagemUpload>
                <ValidationMessage For="@(() => autor.CaminhoImagem)" />
            </div>
            <div>
                <label>Nome</label>
                <InputText @bind-Value="autor.Nome" class="input"></InputText>
                <ValidationMessage For="@(() => autor.Nome)" />
            </div>
            <div>
                <label>Biografia</label>
                <InputTextArea @bind-Value="autor.Biografia" rows="5" class="textarea"></InputTextArea>
                <ValidationMessage For="@(() => autor.Biografia)" />
            </div>
       
            <div>
                <label>Autor ativo?</label>
                <div class="select">
                    <InputSelect @bind-Value="autor.Ativo">
                        <option value="true">Sim</option>
                        <option value="false">Não</option>
                    </InputSelect>
                </div>
            </div>

            <ValidationMessage For="@(() => autor.Ativo)" />
            <div>

                <button class="button is-success" type="submit">SALVAR</button>
                <NavLink href="/" class="button is-danger">CANCELAR</NavLink>
            </div>

        </EditForm>
    }
    else
    {
        <h3>Incluir Autor</h3>

        <EditForm Model="@autor" OnValidSubmit="@CriarAutor" FormName="IncluiAutor" Enhance>
            <DataAnnotationsValidator />
            <div>
                <label>Nome</label>
                <InputText @bind-Value="autor.Nome" class="input"></InputText>
                <ValidationMessage For="@(() => autor.Nome)" />
            </div>
            <div>
                <label>Biografia</label>
                <InputTextArea @bind-Value="autor.Biografia" rows="5" class="textarea"></InputTextArea>
                <ValidationMessage For="@(() => autor.Biografia)" />
            </div>
            <div>
                <label>Caminho imagem</label>
                <ImagemUpload Modelo="autor" DiretorioImagem="autores" LarguraImagem="120"></ImagemUpload>
                <ValidationMessage For="@(() => autor.CaminhoImagem)" />
            </div>
            <div>
                <div>
                    <label>Autor ativo?</label>
                    <div class="select">
                        <InputSelect @bind-Value="autor.Ativo">
                            <option value="true">Sim</option>
                            <option value="false">Não</option>
                        </InputSelect>
                    </div>
                </div>
                <ValidationMessage For="@(() => autor.Ativo)" />
            </div>

            <div>
                <button class="button is-success" type="submit">SALVAR</button>
                <NavLink href="/" class="button is-danger">CANCELAR</NavLink>
            </div>
        </EditForm>
    }
</div>

@code {

    [SupplyParameterFromForm]
    private Autor? autor { get; set; } = new();

    bool modoEdicao = false;

    [Parameter]
    public string? id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(id))
        {

            if (Guid.TryParse(id, out Guid idAutor))
            {
                autor = await AutorService.BuscarPor(idAutor);
                modoEdicao = true;
            }
            else
            {
                // id inválido, redireciona 
                NavigationManager.NavigateTo("/autores");
            }
        }
    }

    async Task CriarAutor()
    {
        await AutorService.Adicionar(autor);
        NavigationManager.NavigateTo("/autores");
    }

    async Task AtualizarAutor()
    {
        await AutorService.Atualizar(autor);
        NavigationManager.NavigateTo("/autores");
    }
}
