@page "/int/autores/";

@using Blog.Blazor.Interfaces
@using Blog.Blazor.Models

@rendermode InteractiveServer
@inject IJSRuntime JSRuntime;
@inject IAutorService AutorService;

<div class="container p-4">
    <PlaceHolder Visible="autores != null && autores.Any()">
        <table class="table is-bordered">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nome</th>
                    <th>Cadastro</th>
                    <th>Biografia</th>
                    <th colspan="2">Ações</th>
                </tr>
            </thead>
            <tbody>
                <Repeater DataSource="autores" Context="item">
                    <ItemTemplate>
                        <tr>
                            <td>@item.Id</td>
                            <td>@item.Nome</td>
                            <td>@item.Biografia</td>
                            <td>@item.Cadastro.ToShortDateString()</td>
                            <td>
                                <NavLink href="@($"int/autor/editar/{item.Id}")"><FeatherEdit Size="20" Color="#000" StrokeWidth="1.8f" /></NavLink>
                            </td>
                            <td>
                                <a @onclick="async () => await RemoverAutor(item.Id)"><FeatherTrash Size="20" Color="#000" StrokeWidth="1.8f" /></a>
                            </td>
                        </tr>
                    </ItemTemplate>
                </Repeater>
            </tbody>
        </table>
    </PlaceHolder>
    <PlaceHolder Visible="!autores.Any()">
        <article class="message is-warning">
            <div class="message-body">
                No momento, não há publicações disponíveis para exibição.
                <div class="block mt-3 mb-3">
                    <NavLink href="/int/post/novo" class="button is-info">
                        <FeatherPlusCircle Size="20" Color="#000" StrokeWidth="1.8f" />&nbsp;Nova publicação
                    </NavLink>
                </div>
            </div>
        </article>
    </PlaceHolder>
</div>

@code {
    private IQueryable<Autor> autores;

    protected override async Task OnInitializedAsync() {

        autores = await AutorService.BuscarTodos();
    }

    async Task RemoverAutor(Guid id)
    {
        // exibe um alerta de confirmacao
        bool confirm = await JSRuntime.InvokeAsync<bool>("confirm", "Tem certeza que deseja excluir esse autor? Posts deste autor, tambem serão removidos.");

        // se a confirmacao for false para por aqui
        if (confirm is false) return;

        // se a confirmacao for true logaliza  pelo id
        var autor = await AutorService.BuscarPor(id);

        // apaga o autor
        await AutorService.Apagar(autor);

        // atualiza a lista
        autores = await AutorService.BuscarTodos();

        StateHasChanged();
    }
}
