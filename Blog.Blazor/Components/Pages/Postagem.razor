@page "/post/{Id}";

@using Blog.Blazor.Interfaces
@using Blog.Blazor.Models

@inject NavigationManager NavigationManager
@inject IPostService PostService;
@inject ICategoriaService CategoriaService;
@inject IAutorService AutorService;

<PageTitle>@post.Titulo</PageTitle>
<HeadContent><meta name="description" content="@post.DescricaoSEO" /></HeadContent>

<div class="container p-4">
    <div class="content">
        <img src="@post.CaminhoImagem" />
        <h1 class="title">@post.Titulo</h1>
        <p>@post.Categoria.Nome</p>
        <p>Publicado @(post.Cadastro.Date == DateTime.Now.Date ? "Hoje ás " + post.Cadastro.ToString("HH:MM") :
        post.Cadastro.Date == DateTime.Now.Date.AddDays(-1) ? "Ontem ás " + post.Cadastro.ToString("HH:MM") :
        "em " + post.Cadastro.ToShortDateString() + " ás " + post.Cadastro.ToString("HH:MM")) por @post.Autor.Nome</p>
        <p>@((MarkupString)post.Conteudo)</p>
        <PlaceHolder Visible="post.UltimaAtualizacao > post.Cadastro">
            Atualizado em: @post.UltimaAtualizacao.ToShortDateString();
        </PlaceHolder>
    </div>
    <NavLink class="button is-black is-medium" href="/">
        <FeatherArrowLeft Size="25" Color="#FFF" StrokeWidth="1.8f" />
    </NavLink>
</div>

@code {

    [Parameter] public string? Id { get; set; }

    private Post post = new();

    protected override async Task OnInitializedAsync()
    {

        if (!string.IsNullOrEmpty(Id))
        {
            if (Guid.TryParse(Id, out Guid idPost))
            {
                // busca post e alimenta autor e categoria
                post = await PostService.BuscarPor(idPost);
                post.Categoria = await CategoriaService.BuscarPor(post.IdCategoria);
                post.Autor = await AutorService.BuscarPor(post.IdAutor);
            }
            else
            {
                // ID inválido, redireciona para listagem de autores
                NavigationManager.NavigateTo("/");
            }
        }
    }
}